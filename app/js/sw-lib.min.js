/*
 Copyright 2016 Google Inc. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
(function(e,r){'object'==typeof exports&&'undefined'!=typeof module?module.exports=r():'function'==typeof define&&define.amd?define(r):(e.goog=e.goog||{},e.goog.swlib=r())})(this,function(){'use strict';function e(be,Ee){for(var Ie,Ne=[],qe=0,xe=0,Ce='',ke=Ee&&Ee.delimiter||'/';null!=(Ie=S.exec(be));){var we=Ie[0],Te=Ie[1],Se=Ie.index;if(Ce+=be.slice(xe,Se),xe=Se+we.length,Te){Ce+=Te[1];continue}var De=be[xe],Me=Ie[2],We=Ie[3],Ae=Ie[4],Re=Ie[5],Pe=Ie[6],Oe=Ie[7];Ce&&(Ne.push(Ce),Ce='');var je=Ie[2]||ke,Ue=Ae||Re;Ne.push({name:We||qe++,prefix:Me||'',delimiter:je,optional:'?'===Pe||'*'===Pe,repeat:'+'===Pe||'*'===Pe,partial:null!=Me&&null!=De&&De!==Me,asterisk:!!Oe,pattern:Ue?s(Ue):Oe?'.*':'[^'+n(je)+']+?'})}return xe<be.length&&(Ce+=be.substr(xe)),Ce&&Ne.push(Ce),Ne}function r(be){return encodeURI(be).replace(/[\/?#]/g,function(Ee){return'%'+Ee.charCodeAt(0).toString(16).toUpperCase()})}function t(be){return encodeURI(be).replace(/[?#]/g,function(Ee){return'%'+Ee.charCodeAt(0).toString(16).toUpperCase()})}function a(be){var Ee=Array(be.length);for(var Ne=0;Ne<be.length;Ne++)'object'==typeof be[Ne]&&(Ee[Ne]=new RegExp('^(?:'+be[Ne].pattern+')$'));return function(qe,xe){var Ce='',ke=qe||{},Ie=(xe||{}).pretty?r:encodeURIComponent;for(var we=0;we<be.length;we++){var Te=be[we];if('string'==typeof Te){Ce+=Te;continue}var De,Se=ke[Te.name];if(null==Se)if(Te.optional){Te.partial&&(Ce+=Te.prefix);continue}else throw new TypeError('Expected "'+Te.name+'" to be defined');if(w(Se)){if(!Te.repeat)throw new TypeError('Expected "'+Te.name+'" to not repeat, but received `'+JSON.stringify(Se)+'`');if(0===Se.length)if(Te.optional)continue;else throw new TypeError('Expected "'+Te.name+'" to not be empty');for(var Me=0;Me<Se.length;Me++){if(De=Ie(Se[Me]),!Ee[we].test(De))throw new TypeError('Expected all "'+Te.name+'" to match "'+Te.pattern+'", but received `'+JSON.stringify(De)+'`');Ce+=(0===Me?Te.prefix:Te.delimiter)+De}continue}if(De=Te.asterisk?t(Se):Ie(Se),!Ee[we].test(De))throw new TypeError('Expected "'+Te.name+'" to match "'+Te.pattern+'", but received "'+De+'"');Ce+=Te.prefix+De}return Ce}}function n(be){return be.replace(/([.+*?=^!:${}()[\]|\/\\])/g,'\\$1')}function s(be){return be.replace(/([=!:$\/()])/g,'\\$1')}function o(be,Ee){return be.keys=Ee,be}function d(be){return be.sensitive?'':'i'}function h(be,Ee){var Ne=be.source.match(/\((?!\?)/g);if(Ne)for(var qe=0;qe<Ne.length;qe++)Ee.push({name:qe,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return o(be,Ee)}function l(be,Ee,Ne){var qe=[];for(var xe=0;xe<be.length;xe++)qe.push(f(be[xe],Ee,Ne).source);var Ce=new RegExp('(?:'+qe.join('|')+')',d(Ne));return o(Ce,Ee)}function u(be,Ee,Ne){return g(e(be,Ne),Ee,Ne)}function g(be,Ee,Ne){w(Ee)||(Ne=Ee||Ne,Ee=[]),Ne=Ne||{};var qe=Ne.strict,xe=!1!==Ne.end,Ce='';for(var ke=0;ke<be.length;ke++){var Ie=be[ke];if('string'==typeof Ie)Ce+=n(Ie);else{var we=n(Ie.prefix),Te='(?:'+Ie.pattern+')';Ee.push(Ie),Ie.repeat&&(Te+='(?:'+we+Te+')*'),Te=Ie.optional?Ie.partial?we+'('+Te+')?':'(?:'+we+'('+Te+'))?':we+'('+Te+')',Ce+=Te}}var Se=n(Ne.delimiter||'/'),De=Ce.slice(-Se.length)===Se;return qe||(Ce=(De?Ce.slice(0,-Se.length):Ce)+'(?:'+Se+'(?=$))?'),Ce+=xe?'$':qe&&De?'':'(?='+Se+'|$)',o(new RegExp('^'+Ce,d(Ne)),Ee)}function f(be,Ee,Ne){return w(Ee)||(Ne=Ee||Ne,Ee=[]),Ne=Ne||{},be instanceof RegExp?h(be,Ee):w(be)?l(be,Ee,Ne):u(be,Ee,Ne)}function y({channel:be,cacheName:Ee,url:Ne,source:qe}){x.isInstance({channel:be},BroadcastChannel),x.isType({cacheName:Ee},'string'),x.isType({source:qe},'string'),x.isType({url:Ne},'string'),be.postMessage({type:'CACHE_UPDATED',meta:qe,payload:{cacheName:Ee,updatedUrl:Ne}})}function _({first:be,second:Ee,headersToCheck:Ne}={}){if(!(be instanceof Response&&Ee instanceof Response&&Ne instanceof Array))throw ge.createError('responses-are-same-parameters-required');return Ne.every(qe=>{return be.headers.has(qe)===Ee.headers.has(qe)&&be.headers.get(qe)===Ee.headers.get(qe)})}class v{constructor(be){this._errors=be}createError(be,Ee){if(!(be in this._errors))throw new Error(`Unable to generate error '${be}'.`);let Ne=this._errors[be].replace(/\s+/g,' '),qe=null;Ee&&(Ne+=` [${Ee.message}]`,qe=Ee.stack);const xe=new Error;return xe.name=be,xe.message=Ne,xe.stack=qe,xe}}const b={'not-in-sw':'sw-lib must be loaded in your service worker file.','unsupported-route-type':'Routes must be either a express style route string, a Regex to capture request URLs or a Route instance.','empty-express-string':'The Express style route string must have some characters, an empty string is invalid.','bad-revisioned-cache-list':`The 'cacheRevisionedAssets()' method expects`+`an array of revisioned urls like so: ['/example/hello.1234.txt', `+`{path: 'hello.txt', revision: '1234'}]`};var E=new v(b);const N={'express-route-requires-absolute-path':`When using ExpressRoute, you must
    provide a path that starts with a '/' character. You can only match
    same-origin requests. For more flexibility, use RegExpRoute.`};var q=new v(N),x={atLeastOne:function(Ee){const Ne=Object.keys(Ee);if(!Ne.some(qe=>Ee[qe]!==void 0))throw Error('Please set at least one of the following parameters: '+Ne.map(qe=>`'${qe}'`).join(', '))},hasMethod:function(Ee,Ne){const qe=Object.keys(Ee).pop(),xe=typeof Ee[qe][Ne];if('function'!=xe)throw Error(`The '${qe}' parameter must be an object that exposes `+`a '${Ne}' method.`)},isInstance:function(Ee,Ne){const qe=Object.keys(Ee).pop();if(!(Ee[qe]instanceof Ne))throw Error(`The '${qe}' parameter must be an instance of `+`'${Ne.name}'`)},isOneOf:function(Ee,Ne){const qe=Object.keys(Ee).pop();if(!Ne.includes(Ee[qe]))throw Error(`The '${qe}' parameter must be set to one of the `+`following: ${Ne}`)},isType:function(Ee,Ne){const qe=Object.keys(Ee).pop(),xe=typeof Ee[qe];if(xe!==Ne)throw Error(`The '${qe}' parameter has the wrong type. `+`(Expected: ${Ne}, actual: ${xe})`)},isSWEnv:function(){return'ServiceWorkerGlobalScope'in self&&self instanceof ServiceWorkerGlobalScope},isValue:function(Ee,Ne){const qe=Object.keys(Ee).pop(),xe=Ee[qe];if(xe!==Ne)throw Error(`The '${qe}' parameter has the wrong value. `+`(Expected: ${Ne}, actual: ${xe})`)}};const C=['DELETE','GET','HEAD','POST','PUT'];class k{constructor({match:be,handler:Ee,method:Ne}={}){x.isType({match:be},'function'),x.hasMethod({handler:Ee},'handle'),this.match=be,this.handler=Ee,Ne?(x.isOneOf({method:Ne},C),this.method=Ne):this.method='GET'}}var I=Array.isArray||function(be){return'[object Array]'==Object.prototype.toString.call(be)},w=I,T=f,S=new RegExp(['(\\\\.)','([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))'].join('|'),'g');T.parse=e,T.compile=function(Ee,Ne){return a(e(Ee,Ne))},T.tokensToFunction=a,T.tokensToRegExp=g;class D extends k{constructor({path:be,handler:Ee,method:Ne}){if('/'!==be.substring(0,1))throw q.createError('express-route-requires-absolute-path');let qe=[];const xe=T(be,qe);super({match:({url:Ce})=>{if(Ce.origin!==location.origin)return null;const ke=Ce.pathname.match(xe);if(!ke)return null;const Ie={};return qe.forEach((we,Te)=>{Ie[we.name]=ke[Te+1]}),Ie},handler:Ee,method:Ne})}}class M extends k{constructor({regExp:be,handler:Ee,method:Ne}){x.isInstance({regExp:be},RegExp),super({match:({url:qe})=>{const xe=qe.href.match(be);return xe?xe.slice(1):null},handler:Ee,method:Ne})}}class W{setDefaultHandler({handler:be}={}){x.hasMethod({handler:be},'handle'),this.defaultHandler=be}setCatchHandler({handler:be}={}){x.hasMethod({handler:be},'handle'),this.catchHandler=be}registerRoutes({routes:be}={}){x.isInstance({routes:be},Array),self.addEventListener('fetch',Ee=>{const Ne=new URL(Ee.request.url);if(Ne.protocol.startsWith('http')){let qe;for(let xe of be||[])if(xe.method===Ee.request.method){const Ce=xe.match({url:Ne,event:Ee});if(Ce){let ke=Ce;Array.isArray(ke)&&0===ke.length?ke=void 0:ke.constructor===Object&&0===Object.keys(ke).length&&(ke=void 0),qe=xe.handler.handle({url:Ne,event:Ee,params:ke});break}}!qe&&this.defaultHandler&&(qe=this.defaultHandler.handle({url:Ne,event:Ee})),qe&&this.catchHandler&&(qe=qe.catch(xe=>{return this.catchHandler.handle({url:Ne,event:Ee,error:xe})})),qe&&Ee.respondWith(qe)}})}registerRoute({route:be}={}){x.isInstance({route:be},k),this.registerRoutes({routes:[be]})}}class A{constructor(){this._router=new W}registerRoute(be,Ee){if('function'==typeof Ee&&(Ee={handle:Ee}),'string'==typeof be){if(0===be.length)throw E.createError('empty-express-string');this._router.registerRoute({route:new D({path:be,handler:Ee})})}else if(be instanceof RegExp)this._router.registerRoute({route:new M({regExp:be,handler:Ee})});else if(be instanceof k)this._router.registerRoute({route:be});else throw E.createError('unsupported-route-type')}}const R={'not-in-sw':'sw-precaching must be loaded in your service worker file.','invalid-revisioned-entry':`File manifest entries must be either a `+`string with revision info in the url or an object with a 'url' and `+`'revision' parameters.`,'invalid-unrevisioned-entry':``,'bad-cache-bust':`The cache bust parameter must be a boolean.`,'duplicate-entry-diff-revisions':`An attempt was made to cache the same `+`url twice with each having different revisions. This is not supported.`,'request-not-cached':`A request failed the criteria to be cached. By `+`default, only responses with 'response.ok = true' are cached.`,'should-override':'Method should be overridden by the extending class.'};var P=new v(R);let O=`sw-runtime-caching`;self&&self.registration&&(O+=`-${self.registration.scope}`);const U=O,B=['cacheDidUpdate','cacheWillMatch','cacheWillUpdate','fetchDidFail'];var K=new v({'multiple-cache-will-update-behaviors':'You cannot register more than one behavior that implements cacheWillUpdate.','multiple-cache-will-match-behaviors':'You cannot register more than one behavior that implements cacheWillMatch.','invalid-reponse-for-caching':'The fetched response could not be cached due to an invalid response code, by default only 20X responses can be cached.'}),F=function(be){return function(){var Ee=be.apply(this,arguments);return new Promise(function(Ne,qe){function xe(Ce,ke){try{var Ie=Ee[Ce](ke),we=Ie.value}catch(Te){return void qe(Te)}return Ie.done?void Ne(we):Promise.resolve(we).then(function(Te){xe('next',Te)},function(Te){xe('throw',Te)})}return xe('next')})}};class H{constructor({cacheName:be,behaviors:Ee,fetchOptions:Ne,matchOptions:qe}={}){if(be?(x.isType({cacheName:be},'string'),this.cacheName=be):this.cacheName=U,Ne&&(x.isType({fetchOptions:Ne},'object'),this.fetchOptions=Ne),qe&&(x.isType({matchOptions:qe},'object'),this.matchOptions=qe),this.behaviorCallbacks={},Ee&&(x.isInstance({behaviors:Ee},Array),Ee.forEach(xe=>{for(let Ce of B)'function'==typeof xe[Ce]&&(this.behaviorCallbacks[Ce]||(this.behaviorCallbacks[Ce]=[]),this.behaviorCallbacks[Ce].push(xe[Ce].bind(xe)))})),this.behaviorCallbacks.cacheWillUpdate&&1!==this.behaviorCallbacks.cacheWillUpdate.length)throw K.createError('multiple-cache-will-update-behaviors');if(this.behaviorCallbacks.cacheWillMatch&&1!==this.behaviorCallbacks.cacheWillMatch.length)throw K.createError('multiple-cache-will-match-behaviors')}getCache(){var be=this;return F(function*(){return be._cache||(be._cache=yield caches.open(be.cacheName)),be._cache})()}match({request:be}){var Ee=this;return F(function*(){x.atLeastOne({request:be});const Ne=yield Ee.getCache();let qe=yield Ne.match(be,Ee.matchOptions);return Ee.behaviorCallbacks.cacheWillMatch&&(qe=Ee.behaviorCallbacks.cacheWillMatch[0]({cachedResponse:qe})),qe})()}fetch({request:be}){var Ee=this;return F(function*(){x.atLeastOne({request:be});try{return yield fetch(be,Ee.fetchOptions)}catch(Ne){if(Ee.behaviorCallbacks.fetchDidFail)for(let qe of Ee.behaviorCallbacks.fetchDidFail)qe({request:be});throw Ne}})()}fetchAndCache({request:be,waitOnCache:Ee,cacheKey:Ne}){var qe=this;return F(function*(){x.atLeastOne({request:be});let xe;const Ce=yield qe.fetch({request:be});let ke=Ce.ok;if(qe.behaviorCallbacks.cacheWillUpdate&&(ke=qe.behaviorCallbacks.cacheWillUpdate[0]({request:be,response:Ce})),ke){const Ie=Ce.clone();xe=qe.getCache().then((()=>{var we=F(function*(Te){let Se;'opaque'!==Ce.type&&qe.behaviorCallbacks.cacheDidUpdate&&(Se=yield qe.match({request:be})),yield Te.put(Ne||be,Ie);for(let De of qe.behaviorCallbacks.cacheDidUpdate||[])De({cacheName:qe.cacheName,oldResponse:Se,newResponse:Ie})});return function(Te){return we.apply(this,arguments)}})())}else if(!ke&&Ee)throw K.createError('invalid-reponse-for-caching');return Ee&&xe&&(yield xe),Ce})()}}class L{constructor({requestWrapper:be}={}){this.requestWrapper=be?be:new H}handle({event:be,params:Ee}={}){throw Error('This abstract method must be implemented in a subclass.')}}class $ extends L{handle({event:be}={}){var Ee=this;return F(function*(){x.isInstance({event:be},FetchEvent);const Ne=yield Ee.requestWrapper.match({request:be.request});return Ne||(yield Ee.requestWrapper.fetchAndCache({request:be.request}))})()}}class G extends L{handle({event:be}={}){var Ee=this;return F(function*(){return x.isInstance({event:be},FetchEvent),yield Ee.requestWrapper.match({request:be.request})})()}}class V extends L{handle({event:be}={}){var Ee=this;return F(function*(){x.isInstance({event:be},FetchEvent);let Ne;try{if(Ne=yield Ee.requestWrapper.fetchAndCache({request:be.request}),Ne)return Ne}catch(qe){}return yield Ee.requestWrapper.match({request:be.request})})()}}class Y extends L{handle({event:be}={}){var Ee=this;return F(function*(){return x.isInstance({event:be},FetchEvent),yield Ee.requestWrapper.fetch({request:be.request})})()}}class z extends L{handle({event:be}={}){var Ee=this;return F(function*(){x.isInstance({event:be},FetchEvent);const Ne=Ee.requestWrapper.fetchAndCache({request:be.request}).catch(function(){return Response.error()}),qe=yield Ee.requestWrapper.match({request:be.request});return qe||(yield Ne)})()}}class X{constructor(be){this._entriesToCache=new Map,this._requestWrapper=new H({cacheName:be,fetchOptions:{credentials:'same-origin'}}),this._cacheName=this._requestWrapper.cacheName}cache(be){this._cachedUrls=null,be.forEach(Ee=>{this._addEntryToInstallList(this._parseEntry(Ee))})}getCacheName(){return this._cacheName}getCachedUrls(){return this._cachedUrls||(this._cachedUrls=Array.from(this._entriesToCache.keys()).map(be=>new URL(be,location).href)),this._cachedUrls}_addEntryToInstallList(be){const Ee=be.entryID,Ne=this._entriesToCache.get(be.entryID);return Ne?void this._onDuplicateInstallEntryFound(be,Ne):void this._entriesToCache.set(Ee,be)}_performInstallStep(){var be=this;return F(function*(){if(0!==be._entriesToCache.size){const Ee=[];return be._entriesToCache.forEach(function(Ne){Ee.push(be._cacheEntry(Ne))}),Promise.all(Ee)}})()}_cacheEntry(be){var Ee=this;return F(function*(){const Ne=yield Ee._isAlreadyCached(be);if(!Ne)try{return yield Ee._requestWrapper.fetchAndCache({request:be.getNetworkRequest(),waitOnCache:!0,cacheKey:be.request}),Ee._onEntryCached(be)}catch(qe){throw P.createError('request-not-cached',{message:`Failed to get a cacheable response for `+`'${be.request.url}': ${qe.message}`})}})()}_cleanUpOldEntries(){var be=this;return F(function*(){if(yield caches.has(be._cacheName)){const Ee=[];be._entriesToCache.forEach(function(Ce){Ee.push(Ce.request.url)});const Ne=yield be._getCache(),qe=yield Ne.keys(),xe=qe.filter(function(Ce){return!Ee.includes(Ce.url)});return Promise.all(xe.map(function(Ce){return Ne.delete(Ce)}))}})()}_getCache(){var be=this;return F(function*(){return be._cache||(be._cache=yield caches.open(be._cacheName)),be._cache})()}_parseEntry(be){throw P.createError('should-override')}_onDuplicateEntryFound(be,Ee){throw P.createError('should-override')}_isAlreadyCached(be){throw P.createError('should-override')}_onEntryCached(be){throw P.createError('should-override')}}var J=function(Ee,Ne){return Ne={exports:{}},Ee(Ne,Ne.exports),Ne.exports}(function(be){'use strict';(function(){function Ee(Pe){return Array.prototype.slice.call(Pe)}function Ne(Pe){return new Promise(function(Oe,je){Pe.onsuccess=function(){Oe(Pe.result)},Pe.onerror=function(){je(Pe.error)}})}function qe(Pe,Oe,je){var Ue,Be=new Promise(function(Ke,Fe){Ue=Pe[Oe].apply(Pe,je),Ne(Ue).then(Ke,Fe)});return Be.request=Ue,Be}function xe(Pe,Oe,je){var Ue=qe(Pe,Oe,je);return Ue.then(function(Be){if(Be)return new Se(Be,Ue.request)})}function Ce(Pe,Oe,je){je.forEach(function(Ue){Object.defineProperty(Pe.prototype,Ue,{get:function(){return this[Oe][Ue]},set:function(Be){this[Oe][Ue]=Be}})})}function ke(Pe,Oe,je,Ue){Ue.forEach(function(Be){Be in je.prototype&&(Pe.prototype[Be]=function(){return qe(this[Oe],Be,arguments)})})}function Ie(Pe,Oe,je,Ue){Ue.forEach(function(Be){Be in je.prototype&&(Pe.prototype[Be]=function(){return this[Oe][Be].apply(this[Oe],arguments)})})}function we(Pe,Oe,je,Ue){Ue.forEach(function(Be){Be in je.prototype&&(Pe.prototype[Be]=function(){return xe(this[Oe],Be,arguments)})})}function Te(Pe){this._index=Pe}function Se(Pe,Oe){this._cursor=Pe,this._request=Oe}function De(Pe){this._store=Pe}function Me(Pe){this._tx=Pe,this.complete=new Promise(function(Oe,je){Pe.oncomplete=function(){Oe()},Pe.onerror=function(){je(Pe.error)},Pe.onabort=function(){je(Pe.error)}})}function We(Pe,Oe,je){this._db=Pe,this.oldVersion=Oe,this.transaction=new Me(je)}function Ae(Pe){this._db=Pe}Ce(Te,'_index',['name','keyPath','multiEntry','unique']),ke(Te,'_index',IDBIndex,['get','getKey','getAll','getAllKeys','count']),we(Te,'_index',IDBIndex,['openCursor','openKeyCursor']),Ce(Se,'_cursor',['direction','key','primaryKey','value']),ke(Se,'_cursor',IDBCursor,['update','delete']),['advance','continue','continuePrimaryKey'].forEach(function(Pe){Pe in IDBCursor.prototype&&(Se.prototype[Pe]=function(){var Oe=this,je=arguments;return Promise.resolve().then(function(){return Oe._cursor[Pe].apply(Oe._cursor,je),Ne(Oe._request).then(function(Ue){if(Ue)return new Se(Ue,Oe._request)})})})}),De.prototype.createIndex=function(){return new Te(this._store.createIndex.apply(this._store,arguments))},De.prototype.index=function(){return new Te(this._store.index.apply(this._store,arguments))},Ce(De,'_store',['name','keyPath','indexNames','autoIncrement']),ke(De,'_store',IDBObjectStore,['put','add','delete','clear','get','getAll','getKey','getAllKeys','count']),we(De,'_store',IDBObjectStore,['openCursor','openKeyCursor']),Ie(De,'_store',IDBObjectStore,['deleteIndex']),Me.prototype.objectStore=function(){return new De(this._tx.objectStore.apply(this._tx,arguments))},Ce(Me,'_tx',['objectStoreNames','mode']),Ie(Me,'_tx',IDBTransaction,['abort']),We.prototype.createObjectStore=function(){return new De(this._db.createObjectStore.apply(this._db,arguments))},Ce(We,'_db',['name','version','objectStoreNames']),Ie(We,'_db',IDBDatabase,['deleteObjectStore','close']),Ae.prototype.transaction=function(){return new Me(this._db.transaction.apply(this._db,arguments))},Ce(Ae,'_db',['name','version','objectStoreNames']),Ie(Ae,'_db',IDBDatabase,['close']),['openCursor','openKeyCursor'].forEach(function(Pe){[De,Te].forEach(function(Oe){Oe.prototype[Pe.replace('open','iterate')]=function(){var je=Ee(arguments),Ue=je[je.length-1],Be=this._store||this._index,Ke=Be[Pe].apply(Be,je.slice(0,-1));Ke.onsuccess=function(){Ue(Ke.result)}}})}),[Te,De].forEach(function(Pe){Pe.prototype.getAll||(Pe.prototype.getAll=function(Oe,je){var Ue=this,Be=[];return new Promise(function(Ke){Ue.iterateCursor(Oe,function(Fe){return Fe?(Be.push(Fe.value),void 0!==je&&Be.length==je?void Ke(Be):void Fe.continue()):void Ke(Be)})})})});var Re={open:function(Pe,Oe,je){var Ue=qe(indexedDB,'open',[Pe,Oe]),Be=Ue.request;return Be.onupgradeneeded=function(Ke){je&&je(new We(Be.result,Ke.oldVersion,Be.transaction))},Ue.then(function(Ke){return new Ae(Ke)})},delete:function(Pe){return qe(indexedDB,'deleteDatabase',[Pe])}};be.exports=Re})()});class Q{constructor(be,Ee,Ne){if(be==void 0||Ee==void 0||Ne==void 0)throw Error('name, version, storeName must be passed to the constructor.');this._name=be,this._version=Ee,this._storeName=Ne}_getDb(){return this._dbPromise?this._dbPromise:(this._dbPromise=J.open(this._name,this._version,be=>{be.createObjectStore(this._storeName)}).then(be=>{return be}),this._dbPromise)}close(){return this._dbPromise?this._dbPromise.then(be=>{be.close(),this._dbPromise=null}):void 0}put(be,Ee){return this._getDb().then(Ne=>{const qe=Ne.transaction(this._storeName,'readwrite'),xe=qe.objectStore(this._storeName);return xe.put(Ee,be),qe.complete})}delete(be){return this._getDb().then(Ee=>{const Ne=Ee.transaction(this._storeName,'readwrite'),qe=Ne.objectStore(this._storeName);return qe.delete(be),Ne.complete})}get(be){return this._getDb().then(Ee=>{return Ee.transaction(this._storeName).objectStore(this._storeName).get(be)})}getAllValues(){return this._getDb().then(be=>{return be.transaction(this._storeName).objectStore(this._storeName).getAll()})}getAllKeys(){return this._getDb().then(be=>{return be.transaction(this._storeName).objectStore(this._storeName).getAllKeys()})}}let Z=`sw-precaching-revisioned-${'v1'}`;self&&self.registration&&(Z+=`-${self.registration.scope}`);const ee=Z;class te{constructor(){this._idbHelper=new Q('sw-precaching','1','asset-revisions')}get(be){return this._idbHelper.get(be)}put(be,Ee){return this._idbHelper.put(be,Ee)}_close(){this._idbHelper.close()}}class ae{constructor({entryID:be,revision:Ee,request:Ne,cacheBust:qe}){this.entryID=be,this.revision=Ee,this.request=Ne,this.cacheBust=qe}getNetworkRequest(){if(!0!==this.cacheBust)return this.request;let be=this.request.url;const Ee={};if(!0===this.cacheBust)if('cache'in Request.prototype)Ee.cache='reload';else{const Ne=new URL(be,location);Ne.search+=(Ne.search?'&':'')+encodeURIComponent('_sw-precaching')+'='+encodeURIComponent(this.revision),be=Ne.toString()}return new Request(be,Ee)}}class ne extends ae{constructor(be){if(x.isType({url:be},'string'),0===be.length)throw P.createError('invalid-revisioned-entry',new Error('Bad url Parameter. It should be a string:'+JSON.stringify(be)));super({entryID:be,revision:be,request:new Request(be),cacheBust:!1})}}class se extends ae{constructor({entryID:be,revision:Ee,url:Ne,cacheBust:qe}){if('undefined'==typeof qe&&(qe=!0),'undefined'==typeof be&&(be=new URL(Ne,location).toString()),x.isType({revision:Ee},'string'),0===Ee.length)throw P.createError('invalid-revisioned-entry',new Error('Bad revision Parameter. It should be a string with at least one character: '+JSON.stringify(Ee)));if(x.isType({url:Ne},'string'),0===Ne.length)throw P.createError('invalid-revisioned-entry',new Error('Bad url Parameter. It should be a string:'+JSON.stringify(Ne)));if(x.isType({entryID:be},'string'),0===be.length)throw P.createError('invalid-revisioned-entry',new Error('Bad entryID Parameter. It should be a string with at least one character: '+JSON.stringify(be)));x.isType({cacheBust:qe},'boolean'),super({entryID:be,revision:Ee,request:new Request(Ne),cacheBust:qe})}}class ie extends X{constructor(){super(ee),this._revisionDetailsModel=new te}cache(be){super.cache(be)}_parseEntry(be){if('undefined'==typeof be||null===be)throw P.createError('invalid-revisioned-entry',new Error('Invalid file entry: '+JSON.stringify(be)));let Ee;switch(typeof be){case'string':Ee=new ne(be);break;case'object':Ee=new se(be);break;default:throw P.createError('invalid-revisioned-entry',new Error('Invalid file entry: '+JSON.stringify(Ee)));}return Ee}_onDuplicateInstallEntryFound(be,Ee){if(Ee.revision!==be.revision)throw P.createError('duplicate-entry-diff-revisions',new Error(`${JSON.stringify(Ee)} <=> `+`${JSON.stringify(be)}`))}_isAlreadyCached(be){var Ee=this;return F(function*(){const Ne=yield Ee._revisionDetailsModel.get(be.entryID);if(Ne!==be.revision)return!1;const qe=yield Ee._getCache(),xe=yield qe.match(be.request);return!!xe})()}_onEntryCached(be){var Ee=this;return F(function*(){yield Ee._revisionDetailsModel.put(be.entryID,be.revision)})()}_close(){this._revisionDetailsModel._close()}}class oe extends ae{constructor(be){if(!(be instanceof Request))throw P.createError('invalid-unrevisioned-entry',new Error('Invalid file entry: '+JSON.stringify(be)));super({entryID:be.url,request:be,cacheBust:!1})}}class ce extends X{constructor(){super()}cache(be){super.cache(be)}_parseEntry(be){if('undefined'==typeof be||null===be)throw P.createError('invalid-unrevisioned-entry',new Error('Invalid file entry: '+JSON.stringify(be)));if('string'==typeof be)return new ne(be);if(be instanceof Request)return new oe(be);throw P.createError('invalid-unrevisioned-entry',new Error('Invalid file entry: '+JSON.stringify(be)))}_onDuplicateInstallEntryFound(be,Ee){}_isAlreadyCached(be){return F(function*(){return!1})()}_onEntryCached(be){}}class de{constructor(){this._eventsRegistered=!1,this._revisionedManager=new ie,this._unrevisionedManager=new ce,this._registerEvents()}_registerEvents(){this._eventsRegistered||(this._eventsRegistered=!0,self.addEventListener('install',be=>{be.waitUntil(this._performInstallStep())}),self.addEventListener('activate',be=>{be.waitUntil(this._performActivateStep())}))}_performInstallStep(){return Promise.all([this._revisionedManager._performInstallStep(),this._unrevisionedManager._performInstallStep()]).then(()=>{this._close()}).catch(be=>{throw this._close(),be})}_performActivateStep(){return Promise.all([this._revisionedManager._cleanUpOldEntries(),this._unrevisionedManager._cleanUpOldEntries()]).then(()=>{this._close()}).catch(be=>{throw this._close(),be})}cacheRevisioned({revisionedFiles:be}={}){x.isInstance({revisionedFiles:be},Array),this._revisionedManager.cache(be)}cacheUnrevisioned({unrevisionedFiles:be}={}){x.isInstance({unrevisionedFiles:be},Array),this._unrevisionedManager.cache(be)}getRevisionedCacheManager(){return this._revisionedManager}getUnrevisionedCacheManager(){return this._unrevisionedManager}_close(){this._revisionedManager._close()}}if(!x.isSWEnv())throw P.createError('not-in-sw');const he=`sw-cache-expiration-${self.registration.scope}`,le='url',pe='timestamp';class ue{constructor({maxEntries:be,maxAgeSeconds:Ee}={}){x.atLeastOne({maxEntries:be,maxAgeSeconds:Ee}),be!==void 0&&x.isType({maxEntries:be},'number'),Ee!==void 0&&x.isType({maxAgeSeconds:Ee},'number'),this.maxEntries=be,this.maxAgeSeconds=Ee,this._dbs=new Map,this._caches=new Map}getDB({cacheName:be}){var Ee=this;return F(function*(){if(!Ee._dbs.has(be)){const Ne=yield J.open(he,1,function(qe){const xe=qe.createObjectStore(be,{keyPath:le});xe.createIndex(pe,pe,{unique:!1})});Ee._dbs.set(be,Ne)}return Ee._dbs.get(be)})()}getCache({cacheName:be}){var Ee=this;return F(function*(){if(!Ee._caches.has(be)){const Ne=yield caches.open(be);Ee._caches.set(be,Ne)}return Ee._caches.get(be)})()}cacheWillMatch({cachedResponse:be}={}){return this.isResponseFresh({cachedResponse:be})?be:null}isResponseFresh({cachedResponse:be}={}){if(be&&this.maxAgeSeconds){x.isInstance({cachedResponse:be},Response);const Ee=be.headers.get('date');if(Ee){const Ne=Date.now(),qe=new Date(Ee);if(qe.getTime()+1000*this.maxAgeSeconds<Ne)return!1}}return!0}cacheDidUpdate({cacheName:be,newResponse:Ee}={}){x.isType({cacheName:be},'string'),x.isInstance({newResponse:Ee},Response);const Ne=Date.now();this.updateTimestamp({cacheName:be,now:Ne,url:Ee.url}).then(()=>{this.expireEntries({cacheName:be,now:Ne})})}updateTimestamp({cacheName:be,url:Ee,now:Ne}){var qe=this;return F(function*(){x.isType({url:Ee},'string'),'undefined'==typeof Ne&&(Ne=Date.now());const xe=yield qe.getDB({cacheName:be}),Ce=xe.transaction(be,'readwrite');Ce.objectStore(be).put({[pe]:Ne,[le]:Ee}),yield Ce.complete})()}expireEntries({cacheName:be,now:Ee}={}){var Ne=this;return F(function*(){'undefined'==typeof Ee&&(Ee=Date.now());const qe=Ne.maxAgeSeconds?yield Ne.findOldEntries({cacheName:be,now:Ee}):[],xe=Ne.maxEntries?yield Ne.findExtraEntries({cacheName:be}):[],Ce=[...new Set(qe.concat(xe))];return yield Ne.deleteFromCacheAndIDB({cacheName:be,urls:Ce}),Ce})()}findOldEntries({cacheName:be,now:Ee}={}){var Ne=this;return F(function*(){x.isType({now:Ee},'number');const qe=Ee-1000*Ne.maxAgeSeconds,xe=[],Ce=yield Ne.getDB({cacheName:be}),ke=Ce.transaction(be,'readonly'),Ie=ke.objectStore(be),we=Ie.index(pe);return we.iterateCursor(function(Te){Te&&(Te.value[pe]<qe&&xe.push(Te.value[le]),Te.continue())}),yield ke.complete,xe})()}findExtraEntries({cacheName:be}){var Ee=this;return F(function*(){const Ne=[],qe=yield Ee.getDB({cacheName:be}),xe=qe.transaction(be,'readonly'),Ce=xe.objectStore(be),ke=Ce.index(pe),Ie=yield ke.count();return Ie>Ee.maxEntries&&ke.iterateCursor(function(we){we&&(Ne.push(we.value[le]),Ie-Ne.length>Ee.maxEntries&&we.continue())}),yield xe.complete,Ne})()}deleteFromCacheAndIDB({cacheName:be,urls:Ee}={}){var Ne=this;return F(function*(){if(x.isInstance({urls:Ee},Array),0<Ee.length){const qe=yield Ne.getCache({cacheName:be}),xe=yield Ne.getDB({cacheName:be});yield Ee.forEach((()=>{var Ce=F(function*(ke){yield qe.delete(ke);const Ie=xe.transaction(be,'readwrite'),we=Ie.objectStore(be);yield we.delete(ke),yield Ie.complete});return function(ke){return Ce.apply(this,arguments)}})())}})()}}const me={'channel-name-required':`The channelName parameter is required when
    constructing a new Behavior`,'responses-are-same-parameters-required':`The first, second, and
    headersToCheck parameters must be valid when calling responsesAreSame()`};var ge=new v(me);const fe=['content-length','etag','last-modified'];class ye{constructor({channelName:be,headersToCheck:Ee,source:Ne}={}){if('string'!=typeof be||0===be.length)throw ge.createError('channel-name-required');this.channelName=be,this.headersToCheck=Ee||fe,this.source=Ne||'sw-broadcast-cache-update'}get channel(){return this._channel||(this._channel=new BroadcastChannel(this.channelName)),this._channel}cacheDidUpdate({cacheName:be,oldResponse:Ee,newResponse:Ne}){x.isType({cacheName:be},'string'),x.isInstance({newResponse:Ne},Response),Ee&&this.notifyIfUpdated({cacheName:be,first:Ee,second:Ne})}notifyIfUpdated({first:be,second:Ee,cacheName:Ne}){x.isType({cacheName:Ne},'string'),_({first:be,second:Ee,headersToCheck:this.headersToCheck})||y({cacheName:Ne,url:Ee.url,channel:this.channel,source:this.source})}}class _e{constructor(){this._router=new A,this._precacheManager=new de,this._registerDefaultRoutes()}cacheRevisionedAssets(be){if(!Array.isArray(be))throw E.createError('bad-revisioned-cache-list');this._precacheManager.cacheRevisioned({revisionedFiles:be})}warmRuntimeCache(be){if(!Array.isArray(be))throw E.createError('bad-revisioned-cache-list');this._precacheManager.cacheUnrevisioned({unrevisionedFiles:be})}get router(){return this._router}get Route(){return k}cacheFirst(be){return this._getCachingMechanism($,be)}cacheOnly(be){return this._getCachingMechanism(G,be)}networkFirst(be){return this._getCachingMechanism(V,be)}networkOnly(be){return this._getCachingMechanism(Y,be)}staleWhileRevalidate(be){return this._getCachingMechanism(z,be)}_getCachingMechanism(be,Ee={}){const Ne={cacheExpiration:ue,broadcastCacheUpdate:ye},qe={behaviors:[]};Ee.cacheName&&(qe.cacheName=Ee.cacheName);const xe=Object.keys(Ne);return xe.forEach(Ce=>{if(Ee[Ce]){const ke=Ne[Ce],Ie=Ee[Ce];qe.behaviors.push(new ke(Ie))}}),Ee.behaviors&&Ee.behaviors.forEach(Ce=>{qe.behaviors.push(Ce)}),new be({requestWrapper:new H(qe)})}_registerDefaultRoutes(){const be=this._precacheManager.getRevisionedCacheManager(),Ee=this.cacheFirst({cacheName:be.getCacheName()}),Ne=new this.Route({match:({url:qe,event:xe})=>{const Ce=be.getCachedUrls();return-1!==Ce.indexOf(qe.href)},handler:Ee});this.router.registerRoute(Ne)}}if(!x.isSWEnv())throw E.createError('not-in-sw');const ve=new _e;return ve});
//# sourceMappingURL=sw-lib.min.js.map
